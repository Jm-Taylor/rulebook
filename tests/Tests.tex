% !TEX root = ../Rulebook.tex
\label{sec:Tests}

\section{General}

\subsection{Common Rules}
\label{ssec: Common Rules}


Unless stated other, the following rules apply to all test types:

\begin{itemize}
\item The order in which the teams have to perform will be determined by a draw from the OC.
\item The prep phase has a time limit of 3 minutes.
\item Teams must not hardcode information gained from runs of previous teams. This is considered as cheating.
\item A single robot is used.
\item The robot must not leave the arena.
\item The maximum objects a robot is allowed to carry is 3. If more than 3 objects are above the robot's footprint, the same rule as for a major collision applies (run stopped or optional restart, stop after 2nd time). 
\item The robot has to start and end at the respective arena location (START, FINISH).
\item The robot will get the task specification from the AC.
\item Reaching each active Service Area successfully is rewarded once with points defined in table \ref{fig:test_scoring}.
\item Service Areas count as succesfully reached as defined in section \ref{sec:ArenaDesign}.
\item Manipulation tasks count as successful as defined in \ref{ssec:GraspingObjects} and \ref{ssec:PlacingObjects}.
\item The score for this test will be calculated as defined in \ref{sec:ScoringAndRanking}.
\item Exact test specification is displayed in table \ref{fig:test_specifications_instance}.
\end{itemize}


%\end{itemize}



%The actual competition contains of a set of so-called tests. 
%A test is specified in terms of it's purpose and focus, environment features and eventually manipulation objects involved. Further, a concrete specification of the task is given and the rules to be obeyed. 

%Each test has different variability dimensions. That is, which objects to be manipulated, how many locations to visit, from which height to grasp etc. The test instances for \YEAR are defined based on the general test description and can be seen in Section~\ref{sec:ScoringAndRanking}.




%Every test has some navigation to a service area involved in it. Successful navigation will be awarded in every test according to Table \ref{tab:InstancePoints}. A navigation to a service area is successful when the robot reached the service area as defined in section \ref{ssec:Navigating}. The rewarded points for navigation to a servie area will be only awarded once per service area.

\subsection{Grasping Objects} \label{ssec:GraspingObjects}

\textbf{General}

An Object counts as successfully grasped, if the robot grasps the correct Object of the correct Service Area and transport it out of the corresponding Manipulation Zone. In that case the Manipulation Zone has an infinite height. 

A robot is allowed to grasps an incorrect Object as long as the Object don't leave the Manipulation Zone with his complete form. This enables a robot to grasp an Object to examine the Object with a camera. If an incorrect Object grasped and moved out of the Service Area it is counted as an \textbf{Incorrect Object Manipulation}.

The grasping process starts when the Manipulator enters the Manipulation Zone und ends when it leaves the Manipulation Zone. In these cases the Manipulation Zone has an infinite height.

If the Objects falls down from the robot platform, the robot drops the Object to the floor after leaving the Manipulation Zone, the Object falls from the Manipulation Zone to the floor or the Object falls on top of the Service Area from a height higher than $5\si{\centi\meter}$ while the grasping process it is counted as an \textbf{Object Loss}.

If the robot collides with an Object, Decoy or Container at the Manipulation Zone while the grasping process it is considered as a \textbf{Manipulation Deduction}.

\textbf{Rotating Table}

It is explicitly NOT allowed to stop the table (e.g. by pushing the gripper into the table surface).

It is also explicitly NOT allowed to position the gripper in a way that blocks the objects 
unless it is during the grasping process of a target object and does not affect the table rotation or other objects.

If one of these both situations happen while a grasping process then no points are rewarded for the following successful grasping of the Object.

\subsection{Placing Objects} \label{ssec:PlacingObjects}

\textbf{General}

An Object counts as successfully placed, if the robot places an correct Object to a Manipulation Zone of the correct Service Area. The robot has to place the Object so that the Object is lying with his complete form inside the Manipulation Zone. The pose of the Object on the Manipulation Zone can be chosen freely by the robot.

The placement process starts when the Manipulator with the Object enters the Manipulation Zone and ends when the placed Object doesn't move anymore and the Manipulator has left the Manipulation Zone. In these cases the Manipulation Zone has an infinite height.

If one (or more) of the following situations occur the fixed \textbf{Manipulation Deduction} will be applied. The fixed \textbf{Manipulation Deduction} is not depending on the type of the manipulation (RT, SH, arbitrary surface etc):

\begin{itemize}
	\item The placed Object or the Manipulator touches another Object, Container or Decoy while the placing process at the Manipulation Zone 
	\item The placed Object is not lying with his complete form within the Manipulation Zone at the end of the placement process
\end{itemize}




If an Object is placed from a height higher than $5\si{\centi\meter}$ to the top of the Manipulation Zone it is considered as an \textbf{Object Loss} and no points are given for a successfull Placing.

If a placed Object is either incorrect or the corresponding Service Area is incorrect, the Placement is considered as an \textbf{Incorrect Object Manipulation}. 


\textbf{Shelf}

The Placement at the upper part of the Shelf has to be in the Manipulation Zone of the upper part of the shelf and it is allowed that the Object is moving down to the lower area of the upper part of the shelf after the placement. If the placed Object collides with an already placed object it is considered as a fixed \textbf{Manipulation Deduction}.


\textbf{Precision Placement}

A successfull Placement of the Object into the cavity will rewarded with a successfull \textbf{Precision Placement}. A successfull Precions Placement is if a  correct Object falls through the correct cavity tile. If the Object is not falling down through the cavity but is stuck in the cavity or is lying with his complete form at the correct cavity at the end of the run it will be rewarded with an successfull \textbf{Cavity Placement}.

If an Object is placed on the wrong cavity tile then no points are given and in this case there is also no Incorrect Object Manipulation penalty as long as the Object has to be placed at this Precision Table. If an Object is placed on a Precision Table that shouldn't be placed there, then the \textbf{Incorrect Object Manipulation} penalty will be apllied. 

There are recovery stragedies allowed at the Precision Table to put the Objects into the cavity.
For example it is allowed to poke with the Object in the Gripper to place the Object into the cavity. This  allows the use of a force sensor for placing the Object into the cavity.
It is also allowed to move the Object on the cavity as long as the Object stays on the same cavity. This ensures that a movement of an Object over the complete Table is not allowed and will be considered as zero points.

 

\textbf{Container Placement}

A container placement is considered as successful when the object touches the bottom of the container. Here are some valid (fig. \ref{fig:example_allenkeyOK}) and some wrong (fig. \ref{fig:example_allenkeyNOTOK}) container placements shown. On the rulebook github page even more pictures can be found. 

\begin{figure}[h!]
	\begin{center}
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/allenkey_ok1.jpg}} \hfill
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/allenkey_ok2.jpg}} \hfill
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/drill_ok1.jpg}} \hfill
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/drill_ok2.jpg}} \hfill
	\end{center}
	\caption{Examples of correct AllenKey and Drill in container placement.}
	\label{fig:example_allenkeyOK}
\end{figure}

Especially with the new advanced object set it is important to not produce an object loss during placement. The object has to be placed so that the fingers are not more than 5cm above the ground (here the bottom of the red container). That means the gripper finger has to be below the container edge (inside the container). 


\begin{figure}[h!]
	\begin{center}
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/allenkey_not_ok1.jpg}} \hfill
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/allenkey_not_ok4.jpg}} \hfill
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/drill_not_ok2.jpg}} \hfill
		\subfloat{\includegraphics[width=0.24\textwidth,rotate=-0]{./images/placement_examples/drill_not_ok4.jpg}} \hfill	
\end{center}
	\caption{Examples of incorrect AllenKey and Drill  in container placement.}
	\label{fig:example_allenkeyNOTOK}
\end{figure}


\newpage
%\input{./tests/BNT}

\input{./tests/New_Test_Structure}

\input{./tests/BMT}

\input{./tests/BTT}

\input{./tests/ATT}

%\input{./tests/PPT}

%\input{./tests/RTT}

\input{./tests/Final.tex}

\input{./tests/Specs}

%\newpage
%\section{Test Variability} \label{sec:TestVariability}

%The different optional parameters and configurations for each task are 
%mentioned in Section~\ref{sec:ArenaDesign} and \ref{sec:ManipulationTasks}. 
%Figure~\ref{fig:complexityTree} summarizes the possible variations and 
%emphasizes aspects that may be chosen.

%\begin{figure}[ht]
%\centering
%\input{./tikz/complexityTree.tikz}
%\caption{Aspects of variability that may be integrated in a specific instance of a test.}
%\label{fig:complexityTree}
%\end{figure}
