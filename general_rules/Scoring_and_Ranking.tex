% !TEX root = ../Rulebook.tex
\section{Scoring} \label{sec:ScoringAndRanking}

For each test the calculation of scores is defined individually, comprising points for achieving certain subtasks,
points for winning a run and penalty points.
\par
Each test provides a set of so-called feature variations encoding the overall variability of the test (e.g. whether
obstacles can occur or not, number and type of manipulation objects). To enhance comparability among different test
runs, all teams will have to perform the same test instances as specified in Table~\ref{tab:Instances}.
\par
If not specified otherwise, the following set of scoring rules applies for each test:


Explanation of the terms:
\begin{itemize}
\item Correct navigating is defined in Section \ref{ssec:Navigating}
\item Correct grasping is defined in Section \ref{ssec:GraspingObjects}
\item Correct placing is defined in Section \ref{ssec:PlacingObjects}
\end{itemize}

\section{Simplifications}
Teams may use simplifications, which will result in a reduction of scores for the given run. The simplifications may be
chosen per run, but need to be announced to the referees at least one hour before the start of the run.

\begin{itemize}
	\item Use of external sensors: \hfill -200 points
	\item Use of other external objects (e.g. to support localization): \hfill -100 points
	\item Use of own loading or unloading areas: \hfill -200 points
  \item Deactivation of Barrier Tape: -15\% of total points of the run
\end{itemize}

Additional simplifications are specified for individual tests. These reductions do not count as penalty points. Teams
that want to make use of the simplifications above have to announce them in advance of the competition to the TC. The
TC might forbid the use of specific elements for simplification if these are not in the spirit of the league or may
cause disproportionate advantages for a team.

\section{Penalties}
\label{sec:penalties}
Penalty points are given as follows, each time again the incident occurs:

\begin{itemize}
	\item A manipulation object is dropped to the floor outside of a manipulation area: \hfill -100 points
	\item Delivering a wrong manipulation object to service area \hfill -50 points
	\item Minor collision (see Section \ref{sec:Collisions}): \hfill -50 points
	\item Major collision (see Section \ref{sec:Collisions}): \hfill -50 points and termination of the run
  \item Barrier Tape collision (see Section \ref{sec:Collisions}): \hfill -5\% of total points of current run up till
  20\%
\end{itemize}

\leander{add penalties for not successful place or at least a reference}

\section{Collisions}\label{sec:Collisions}

For reasons of safety of people and property it is strictly unwanted for the robot to collide
with any of the environmental objects. Only collisions of the manipulator with the upside of
the service area are allowed. The different kind of collisions that can occur are defined in the
following subsections. Any Collisions cause a point penalty that is explained in section \ref{sec:ScoringAndRanking}.  

\textbf{Major Collision:}

If the robot (platform and arm) collides with a static element of the environment or touches a red/white barrier tape it is considered as a major collision. If the manipulator cause a fundemental change of the environment at the service area it is counted as a major collision, this could be for example moving an arbitrary surface off the workspace. A major collision results in the termination of the run and the arena can be restored. 


\textbf{Minor Collision:}

If the manipulator collides with an interaction element of the arena (RTT, PPT Cavities, upper level
of Shelf) it is considered a minor collision. The only exception is the collision of the manipulator
of the robot with the surface of the manipulation area.

\textbf{Tape Collision:}

\begin{description}
  \item[Red/White Tape]: This tape represents a Virtual Wall with an infinitely height. This wall shall not be crossed. If any part of the robot (including the manipulator) is above the tape, it is considered a major collision. 
%  This tape is typically used to limit the area of the arena.
  \item[Yellow/Black Tape]: This tape is called Barrier Tape and represents a Virtual Obstacle. If any part of the robot
  touches a barrier tape, it is considered a Barrier Tape Collision. Barrier Tape collision induce a point penalty
  proportional to the final points of the run. With each collision 5\% of the final points are deducted up to a maximum
  of 20\%. For beginner teams the option exists to opt-out of Barrier Tape and take a static deduction of 15\% of the
  final points of the run.
  \item[Marking Tape]: This tape is used as an universal marker for several purposes and therefore a collision does not matter. 
\end{description}

\begin{table}[h!]
	\caption{Definition of minor and major collisions}
	\label{tab:collisions}
	\centering
  \begin{tabular}{|l|p{1cm}|p{1cm}|p{1.5cm}|}
		\hline
		Situation                                                & Minor & Major & Barrier Tape \\
    \hline
    Collision with static elements of arena                  &       & X     &              \\
    Collision with dynamic elements of arena                 &       & X     &              \\
    Robot Body Collision with workstation                    &       & X     &              \\
    Robot Manipulator Collision with manipulation zone       &       &       &              \\
    Robot Manipulator Collision with Round Table stopping it & X     &       &              \\
    Robot Manipulator Collision with PPT Cavity surface      & X     &       &              \\
    Robot Manipulator Collision with Shelf                   & X     &       &              \\
		Yellow/Black Tape Collisions                             &       &       & X            \\
    Red/White Tape Collisions                                &       & X     &              \\
    %Blue/White Tape Collision (1st time gate)                &       &       &              \\
    %Blue/White Tape Collision (2nd time gate)                &       & X     &              \\
    Marking Tape & & & \\
    \hline
	\end{tabular}
\end{table}

\section{Restarts}
Teams might use one so-called restart in a run. Restarts have the following aspects:

\begin{itemize}

	\item Per run, at most one restart is allowed for a team, if not specified otherwise in a test.
	\item At any time during a run, the team can call for a restart to the referees.
	\item When the referees acknowledge the call for restart, the team may enter the arena. The time will continue running.
	\item The arena and the robot will be reset exactly to the setup at the beginning of the run (except the timer for the run). Random elements such as obstacles or object positions remain like before.
	\item The points for this run achieved so far are reset to zero.
	\item Scores that are received after a restart are multiplied by a factor of 0.75.
	\item The referees decide when the arena is prepared again for the restart. If the robot is not yet ready, teams can keep trying to get it ready until the time for the run is over.
	\item As soon as the team signals that the robot is ready, the task specification is sent again.
	\item Afterwards the start signal is sent from the referee box.

\end{itemize}


\section{Ranking}
The tests will occur in the instances shown in Table~\ref{tab:Instances}. Ranking of the teams will be based on the sum of the achieved points over all the tests.

A team cannot get less than zero points for one run.
The scores of the tests of the first stage are summed up, and the teams with the highest sums proceed to the next stage.

In case of a tie, the OC will either schedule a deciding run or continue with a higher number of participants.

%\setlength{\tabcolsep}{4.75pt}
%\renewcommand{\arraystretch}{1.1}
%\newcommand{\R}[2]{
%	\begin{turn}{90}
%		\begin{minipage}[][1em][c]{#2}
%		#1
%	  \end{minipage}
%	\end{turn}
%}
%
%\newcommand{\cir}[1]{\hspace{0.5em}\unitlength1ex\begin{picture}(2.8,2.8)%
%\put(0.75,0.75){\circle{2.8}}\put(0.75,0.75){\makebox(0,0){#1}}\end{picture}}
%\newcommand{\Y}{\tiny \CIRCLE}
%\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
%
%\definecolor{headlineColor}{rgb}{.7,.7,.7}
%\definecolor{sectionColor}{rgb}{.7,.1,.1}
%
%\newcommand{\C}{\cellcolor{sectionColor}}


\begin{landscape}
\begin{table}
 \centering
 \begin{tabular}{|p{5.5cm}*{9}{|P{1cm}}|}
   \hhline{~--------}
   \multicolumn{1}{l|}{}                       & \multicolumn{8}{c|}{Instances}                               \\
   \hhline{~--------}
   \multicolumn{1}{l|}{}                       &\cir{1} &\cir{2} &\cir{3} &\cir{4} &\cir{5} &\cir{6} &\cir{7} \\
   \multicolumn{1}{r|}{}                       & BMT    & BTT1   & BTT2   &  BTT3  & PPT    &  RTT   & Final  \\
   \hhline{~--------}
   \hline
	 Correct service area reached                &   25   &   25   &  25    &   25   &  25    &   25   &   25   \\ \hline
   Correct object grasping           &    &    &     &    &     &        &    \\
     \hspace{0.5cm} standard            &  100   &  100   & 100    &  100   &   0    &        &  100   \\
	 \hspace{0.5cm} round table                  &        &        &        &        &        &  300   &  200   \\
	 \hspace{0.5cm} PPT area                     &        &        &        &        &        &        &  200   \\
	 \hspace{0.5cm} arbitrary surface (tbdiscussed... reduce points)           &        &  150   & 150    &  150   &        &        &  150   \\
	 \hspace{0.5cm} shelf upper level            &        &        &        &  150   &        &        &  150   \\
	 \hspace{0.5cm} shelf lower level            &        &        &        &  300   &        &        &  300   \\ \hline
   Correct object placing standard (tbdiscussed... increase, more than grasping to motivate the teams to implement placement with collision avoidance?)            &   75   &   75   &   75   &   75   &        &        &   75   \\
	 \hspace{0.5cm} PPT area                     &        &        &        &        &  200   &        &  200   \\
	 \hspace{0.5cm} shelf upper level            &        &        &        &  150   &        &        &  150   \\
	 \hspace{0.5cm} shelf lower level            &        &        &        &  150   &        &        &  150   \\ \hline
   Incorrect object placing tbdiscussed... (wrong service area?)                   & -100   & -100   & -100   & -100   & -100   &        & -100   \\
	Incorrect object placing tbdiscussed... (outside manipulation zone and/or touching other objects)                    & 50   & 50   & 50   & 50   & 50   &        & 50   \\
   Incorrect object grasping                   &        & -100   & -100   & -100   &        & -100   & -100   \\
   Completing whole task                       &   75   &  100   &  150   &  250   &   50   &   75   &  300   \\ \hline\hline
   Maximum attainable points\newline (time bonus not included)
	                                             & 1000   & 1100   & 1400   &  2000  &  700   &  1000  &  3200  \\ \hline
 \end{tabular}
 \caption{Scoring in the instances of the \RCAW \YEAR competition.}
  \label{tab:InstancePoints}
\end{table}
\end{landscape}
